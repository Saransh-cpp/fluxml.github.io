<!DOCTYPE html> <html lang=en > <style> #cppn{ position:absolute; top:0; bottom:0; height: 100%; width: 100vw; } iframe { display: block; border-style:none; } </style> <meta property="og:title" content=Flux.jl > <meta property="og:description" content="The elegant machine learning library"> <meta property="og:image" content="/assets/images/FluxGitHubPreview.png"> <meta property="og:url" content=fluxml.ai > <meta name="twitter:title" content=Flux.jl > <meta name="twitter:description" content="The elegant machine learning library"> <meta name="twitter:image" content="/assets/images/FluxGitHubPreview.png"> <meta name="twitter:card" content=summary_large_image > <link rel=apple-touch-icon  sizes=180x180  href="assets/favicon_io/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="assets/favicon_io/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="assets/favicon_io/favicon-16x16.png"> <link rel=manifest  href="assets/favicon_io/site.webmanifest"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-36890222-9"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-36890222-9'); </script> <meta charset=utf-8 > <meta name=viewport  content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel=stylesheet  href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin=anonymous > <link rel=stylesheet  href="../../css/script_default.css"> <link rel=stylesheet  href="../../css/site.css"> <link rel=stylesheet  href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin=anonymous > <link rel=stylesheet  href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin=anonymous > <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin=anonymous ></script> <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin=anonymous  onload="renderMathInElement(document.body, { delimiters: [ {left: '$[[', right: ']]', display: true}, {left: '\\[', right: '\\]', display: true}, {left: '[[', right: ']]', display: false} ] });"> </script> <title>Flux – Elegant ML</title> <nav class="navbar navbar-expand-lg navbar-dark container lighter"> <a class=navbar-brand  href="../../"> <div class=logo  style="font-size:30pt;margin-top:-15px;margin-bottom:-10px;">flux</div> </a> <button class=navbar-toggler  type=button  data-toggle=collapse  data-target="#navbarSupportedContent" aria-controls=navbarSupportedContent  aria-expanded=false  aria-label="Toggle navigation"> <span class=navbar-toggler-icon ></span> </button> <div class="collapse navbar-collapse" id=navbarSupportedContent > <ul class="navbar-nav mr-auto"> <li class=nav-item > <a class=nav-link  href="../../getting_started/">Getting Started</a> <li class=nav-item > <a class=nav-link  href="https://fluxml.ai/Flux.jl/" target=_blank >Docs</a> <li class=nav-item > <a class=nav-link  href="../../blog/">Blog</a> <li class=nav-item > <a class=nav-link  href="../../tutorials/">Tutorials</a> <li class=nav-item > <a class=nav-link  href="https://fluxml.ai/Flux.jl/dev/ecosystem/">Ecosystem</a> <li class=nav-item > <a class=nav-link  href="../../gsoc/">GSoC</a> <li class=nav-item > <a class=nav-link  href="https://discourse.julialang.org/c/domain/ML" target=_blank >Discuss</a> <li class=nav-item > <a class=nav-link  href="https://github.com/FluxML/Flux.jl" target=_blank >GitHub</a> <li class=nav-item > <a class=nav-link  href="https://stackoverflow.com/questions/tagged/flux.jl" target=_blank >Stack Overflow</a> <li class=nav-item > <a class=nav-link  href="https://github.com/FluxML/Flux.jl/blob/master/CONTRIBUTING.md" target=_blank >Contribute</a> </ul> </div> </nav> <div class=content > <div class=container > <h1>Using Flux DataLoader</h1> <div class=franklin-content > <p>In this tutorial, we show how to load image data in Flux DataLoader and process it in mini-batches. We use the <a href="https://fluxml.ai/Flux.jl/stable/data/dataloader/#Flux.Data.DataLoader">DataLoader</a> type to handle iteration over mini-batches of data. For this example, we load the <a href="https://juliaml.github.io/MLDatasets.jl/stable/datasets/MNIST/">MNIST dataset</a> using the <a href="https://juliaml.github.io/MLDatasets.jl/stable/">MLDatasets</a> package.</p> <p>Before we start, make sure you have installed the following packages:</p> <ul> <li><p><a href="https://github.com/FluxML/Flux.jl">Flux</a></p> <li><p><a href="https://juliaml.github.io/MLDatasets.jl/stable/">MLDatasets</a></p> </ul> <p>To install these packages, run the following in the REPL:</p> <pre><code class="julia hljs">Pkg.add(<span class=hljs-string >&quot;Flux&quot;</span>)
Pkg.add(<span class=hljs-string >&quot;MLDatasets&quot;</span>)</code></pre> <p>Load the packages we&#39;ll need:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> MLDatasets: MNIST
<span class=hljs-keyword >using</span> Flux.Data: DataLoader
<span class=hljs-keyword >using</span> Flux: onehotbatch</code></pre> <h2 id=step1_loading_the_mnist_data_set ><a href="#step1_loading_the_mnist_data_set" class=header-anchor >Step1: Loading the MNIST data set</a></h2> <p>We load the MNIST train and test data from MLDatasets:</p> <pre><code class="julia hljs">train_x, train_y = MNIST(:train)[:]
test_x, test_y = MNIST(:test)[:]</code></pre> <p>This code loads the MNIST train and test images as Float32 as well as their labels. The data set <code>train_x</code> is a 28×28×60000 multi-dimensional array. It contains 60000 elements and each one of it contains a 28x28 array. Each array represents a 28x28 image &#40;in grayscale&#41; of a handwritten digit. Moreover, each element of the 28x28 arrays is a pixel that represents the amount of light that it contains. On the other hand, <code>test_y</code> is a 60000 element vector and each element of this vector represents the label or actual value &#40;0 to 9&#41; of a handwritten digit.</p> <h2 id=step_2_loading_the_dataset_onto_dataloader ><a href="#step_2_loading_the_dataset_onto_dataloader" class=header-anchor >Step 2: Loading the dataset onto DataLoader</a></h2> <p>Before we load the data onto a DataLoader, we need to reshape it so that it has the correct shape for Flux. For this example, the MNIST train data must be of the same dimension as our model&#39;s input and output layers.</p> <p>For example, if our model&#39;s input layer expects a 28x28x1 multi-dimensional array, we need to reshape the train and test data as follows:</p> <pre><code class="julia hljs">train_x = reshape(train_x, <span class=hljs-number >28</span>, <span class=hljs-number >28</span>, <span class=hljs-number >1</span>, :)
test_x = reshape(test_x, <span class=hljs-number >28</span>, <span class=hljs-number >28</span>, <span class=hljs-number >1</span>, :)</code></pre> <p>Also, the MNIST labels must be encoded as a vector with the same dimension as the number of categories &#40;unique handwritten digits&#41; in the data set. To encode the labels, we use the <a href="https://fluxml.ai/Flux.jl/stable/data/onehot/#Batches-1">Flux&#39;s onehotbatch</a> function:</p> <pre><code class="julia hljs">train_y, test_y = onehotbatch(train_y, <span class=hljs-number >0</span>:<span class=hljs-number >9</span>), onehotbatch(test_y, <span class=hljs-number >0</span>:<span class=hljs-number >9</span>)</code></pre>
<blockquote>
<p><strong>Note:</strong> For more information on other encoding methods, see <a href="https://fluxml.ai/Flux.jl/stable/data/onehot/">Handling Data in Flux</a>.</p>
</blockquote>
<p>Now, we load the train images and their labels onto a DataLoader object:</p>
<pre><code class="julia hljs">data_loader = DataLoader((train_x, train_y); batchsize=<span class=hljs-number >128</span>, shuffle=<span class=hljs-literal >true</span>)</code></pre>
<p>Notice that we set the DataLoader <code>batchsize</code> to 128. This will enable us to iterate over the data in batches of size 128. Also, by setting <code>shuffle&#61;true</code> the DataLoader will shuffle the observations each time that iterations are re-started.</p>
<h2 id=step_3_iterating_over_the_data ><a href="#step_3_iterating_over_the_data" class=header-anchor >Step 3: Iterating over the data</a></h2>
<p>Finally, we can iterate over the 60000 MNIST train data in mini-batches &#40;most of them of size 128&#41; using the Dataloader that we created in the previous step. Each element of the DataLoader is a tuple <code>&#40;x, y&#41;</code>  in which <code>x</code> represents a 28x28x1 array and <code>y</code> a vector that encodes the corresponding label of the image.</p>
<pre><code class="julia hljs"><span class=hljs-keyword >for</span> (x, y) <span class=hljs-keyword >in</span> data_loader
   <span class=hljs-meta >@assert</span> size(x) == (<span class=hljs-number >28</span>, <span class=hljs-number >28</span>, <span class=hljs-number >1</span>, <span class=hljs-number >128</span>) || size(x) == (<span class=hljs-number >28</span>, <span class=hljs-number >28</span>, <span class=hljs-number >1</span>, <span class=hljs-number >96</span>)
   <span class=hljs-meta >@assert</span> size(y) == (<span class=hljs-number >10</span>, <span class=hljs-number >128</span>) || size(y) == (<span class=hljs-number >10</span>, <span class=hljs-number >96</span>)
   ...
<span class=hljs-keyword >end</span></code></pre>
<p>Now, we can create a model and train it using the <code>data_loader</code> we just created. For more information on building models in Flux, see <a href="https://fluxml.ai/Flux.jl/stable/models/basics/#Model-Building-Basics-1">Model-Building Basics</a>.</p>



<p class=author >– Liliana Badillo, Dhairya Gandhi</p>

</div>    

    
      </div>
    </div>
    

    
    <div class="container footer lighter">
      <p>Flux: A Deep Learning Library for the Julia Programming Language
</p>
      <a href="https://twitter.com/FluxML?ref_src=twsrc%5Etfw" class=twitter-follow-button  data-show-count=false >Follow @FluxML</a>
      <script async src="https://platform.twitter.com/widgets.js" charset=utf-8 ></script>
    </div>

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    
    
    
    <script src="/.//instant.page/1.0.0" type=module  integrity="sha384-6w2SekMzCkuMQ9sEbq0cLviD/yR2HfA/+ekmKiBnFlsoSvb/VmQFSi/umVShadQI"></script>